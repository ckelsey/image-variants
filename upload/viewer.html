<!doctype html>
<html>

<head>
	<!--
	<todo>
		- vr/mobile
		- fullscreen
	</todo>
	-->
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Image variants viewer test</title>
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width">
	<style>
		html {
			background-color: #eee;
			color: #555;
		}

		body {
			font-family: sans-serif;
			margin: 0px;
		}

		img {
			width: 70px;
			vertical-align: middle;
			display: inline-block;
			margin: 0px 7px;
		}

		p {
			font-size: 12px;
		}

		#canvas_outer {
			width: 100vw;
			height: 70vh;
			max-width: 100%;
			position: relative;
		}

		#canvas_wrapper {
			width: 100%;
			height: 100%;
		}
	</style>
</head>

<body>
	<div id="canvas_outer">
		<div id="canvas_wrapper"></div>
	</div>
	<div>
		<input type="file" id="file_input" style="background: #fff; padding: 7px;">
		<span id="status"></span>
	</div>
	<script src="http://localhost:13463/uploadjs/three.min.js"></script>
	<script src="http://localhost:13463/uploadjs/exif.js"></script>
	<script src="http://localhost:13463/uploadjs/png.js"></script>
	<script src="http://localhost:13463/uploadjs/fabric.min.js"></script>
	<script src="http://localhost:13463/uploadjs/image-reader.js"></script>
	<script src="http://localhost:13463/uploadjs/getThis.js"></script>
	<script src="http://localhost:13463/uploadjs/getMeta.js"></script>
	<script src="http://localhost:13463/uploadjs/draw2d.js"></script>
	<script src="http://localhost:13463/uploadjs/draw3d.js"></script>
	<script src="http://localhost:13463/uploadjs/draw360.js"></script>
	<script>
		var input = document.getElementById("file_input")
		var statusMessage = document.getElementById("status")

		function drawCanvas(file) {

			statusMessage.textContent = "Getting metadata"

			getMetadata(file).then(function (meta) {

				statusMessage.textContent = "Drawing"
				var method = null
				var canvasWrapper = document.getElementById("canvas_wrapper")
				var new_canvasWrapper = canvasWrapper.cloneNode(true);
				canvasWrapper.parentNode.replaceChild(new_canvasWrapper, canvasWrapper);

				if (meta["360"]) {
					method = draw360(file, new_canvasWrapper)
				} else if (meta["3d"]) {
					method = draw3D(file, new_canvasWrapper, false)
				} else {
					method = draw2D(file, new_canvasWrapper, false)
				}

				method.then(function (onUpdate) {

					statusMessage.textContent = ""
				})
			}, function () {

				statusMessage.textContent = "Not a valid GeForce image"
				input.value = null
			})
		}

		input.addEventListener("change", function () {

			drawCanvas(this.files[0])
		}, false)

	</script> </body>

</html>